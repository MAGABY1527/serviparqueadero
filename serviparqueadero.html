<script>
async function cargarDatos() {
  const params = new URLSearchParams(window.location.search);

  const imgEl = document.getElementById("imagen");
  let urlImg = params.get("imagen");

  // Fallback a tu logo en GitHub si no llega o falla
  if (!urlImg) {
    urlImg = "https://raw.githubusercontent.com/MAGABY1527/serviparqueadero/main/servipark.jpg";
  }

  try {
    const dataUrl = await toDataURL(urlImg);
    imgEl.src = dataUrl;
  } catch (e) {
    console.warn("No se pudo convertir a base64, usando directo:", e);
    imgEl.src = urlImg;
  }

  // Resto de campos
  setText("fecha", params.get("fecha"));
  setText("norecibo", params.get("norecibo"));
  setText("placa", params.get("placa"));
  setText("ingreso", params.get("ingreso"));
  setText("salida", params.get("salida"));
  setText("total", params.get("total"));

  const precio = params.get("precio");
  if (precio) {
    setText("precio", precio);
    document.getElementById("row-precio").classList.remove("hidden");
  }

  window.print();
}

function setText(id, value) {
  const el = document.getElementById(id);
  if (el) el.textContent = value || "";
}

async function toDataURL(url) {
  const res = await fetch(url, {mode: "cors"});
  if (!res.ok) throw new Error("Error HTTP " + res.status);
  const blob = await res.blob();
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onloadend = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(blob);
  });
}
</script>
